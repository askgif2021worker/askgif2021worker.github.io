{"id":308,"title":"Using Moq to Mock Entity Framework DBSet objects","imageUrl":"c8e8ffe9-8d90-4cf5-a9a0-51866c6c6056_moq-ef.jpg","dateCreated":"2019-03-23T12:57:02.663Z","dateModified":"2019-03-23T14:12:53.798Z","contributedBy":"AskGif","content":"<p>Unit testing in .NET is pretty nice when your dependency injection/IoC is set up well, but Entity Framework 6 isn&rsquo;t the nicest framework for mocking and testing. If you&rsquo;re using ASP.NET MVC 5, you may have run into this scenario.</p>\r\n<p>&nbsp;</p>\r\n<p>Problem: You want to use or mock a DbSet</p>\r\n<p>So you have an IEnumerable (list, array, etc) that you want to use on your tests, but your DbContext only has DbSets. Unfortunately, the DbSet constructor is protected, so you can&rsquo;t just &lsquo;new&rsquo; one up. The solution is our friend Moq.</p>\r\n<p>&nbsp;</p>\r\n<p>Solution</p>\r\n<p>This handy IEnumerable extension will give you back a DBSet with your IEnumerable in the data. Now you can mock out your DbContext properties or result sets however you wish! You probably want to leave callBase as true to the base implementation is called when you haven&rsquo;t set up certain properties, but if you&rsquo;re having problems, maybe try setting callBase to false.</p>\r\n<pre class=\"language-csharp\"><code>public static class TestingExtensions\r\n{\r\n    private static Mock&lt;DbSet&lt;T&gt;&gt; AsMockDbSet&lt;T&gt;(IEnumerable&lt;T&gt; data, bool callBase = true) where T : class\r\n    {\r\n        var mockSet = new Mock&lt;DbSet&lt;T&gt;&gt;();\r\n        var queryable = data.AsQueryable();\r\n\r\n        mockSet.As&lt;IQueryable&lt;T&gt;&gt;().Setup(m =&gt; m.Provider).Returns(queryable.Provider);\r\n        mockSet.As&lt;IQueryable&lt;T&gt;&gt;().Setup(m =&gt; m.Expression).Returns(queryable.Expression);\r\n        mockSet.As&lt;IQueryable&lt;T&gt;&gt;().Setup(m =&gt; m.ElementType).Returns(queryable.ElementType);\r\n        mockSet.As&lt;IQueryable&lt;T&gt;&gt;().Setup(m =&gt; m.GetEnumerator()).Returns(queryable.GetEnumerator());\r\n\r\n        mockSet.CallBase = callBase;\r\n\r\n        return mockSet;\r\n    }\r\n}</code></pre>","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/c8e8ffe9-8d90-4cf5-a9a0-51866c6c6056_moq-ef.jpg","subContents":[],"category":{"name":"coding","slug":"coding"},"slug":"using-moq-to-mock-entity-framework-dbset-objects","tags":[{"name":"asp-dot-net","slug":"asp-dot-net"},{"name":"ninject","slug":"ninject"},{"name":"mvc-5","slug":"mvc-5"}],"recommendations":[{"id":405,"title":"Nginx Reverse Proxy to ASP.NET Core In Same Docker Container","imageUrl":"851b560d-0263-4e5d-9426-f7dad119ba6c_target-architecture-docker-nginx-ketrel.png","dateCreated":"2019-06-25T02:25:00.552Z","dateModified":"2019-06-26T08:34:17.75Z","contributedBy":"AskGif","content":"As mentioned in the <a title=\"Hosting ASP.NET Core in Docker\" href=\"../../../../blog/404/hosting-asp-net-core-in-docker/\" target=\"_blank\" rel=\"noopener\">previous post (Hosting ASP.NET Core in Docker)</a>, it is recommended to use something other than Kestrel as the front-line web server. In this ","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/851b560d-0263-4e5d-9426-f7dad119ba6c_target-architecture-docker-nginx-ketrel.png","category":{"name":"coding","slug":"coding"},"tags":[{"name":"nginx","slug":"nginx"},{"name":"dotnet-core","slug":"dotnet-core"},{"name":"asp-dot-net","slug":"asp-dot-net"},{"name":"docker","slug":"docker"}],"slug":"nginx-reverse-proxy-to-asp.net-core-in-same-docker-container","total":0},{"id":309,"title":"Listening to IIS Application pool recycle events in ASP.NET","imageUrl":"ab60056b-3b7a-498c-8801-22be557ee7f1_iis.jpg","dateCreated":"2019-03-23T13:27:22.297Z","dateModified":"2019-03-23T14:13:05.405Z","contributedBy":"AskGif","content":"One of my .NET apps was having some strange issues. It was attached to an IIS app pool, so it was possible that the app pool was recycling due to some other application&rsquo;s events or otherwise. I decided to create a listener to detect whenever the app pool was recycling and log what was causi","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/ab60056b-3b7a-498c-8801-22be557ee7f1_iis.jpg","category":{"name":"coding","slug":"coding"},"tags":[{"name":"c-sharp","slug":"c-sharp"},{"name":"asp-dot-net","slug":"asp-dot-net"}],"slug":"listening-to-iis-application-pool-recycle-events-in-asp.net","total":0},{"id":301,"title":"How to deploy ASP.NET Core 1.0.1 to Heroku ?","imageUrl":"1725c1c9-c45b-4804-bfe4-45c40bb1db56_dotnetcore-heroku.jpg","dateCreated":"2019-03-21T03:23:05.072Z","dateModified":"2019-03-21T03:23:26.042Z","contributedBy":"AskGif","content":"Heroku is a great Infrastructure as a Service platform that provides easy deployment for Node, Ruby, PHP, Go, and many others &ndash; unfortunately, this does not include ASP.NET out-of-the-box. This is because ASP.NET has been a Windows-only platform since its inception, and Heroku only supports","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/1725c1c9-c45b-4804-bfe4-45c40bb1db56_dotnetcore-heroku.jpg","category":{"name":"coding","slug":"coding"},"tags":[{"name":"c-sharp","slug":"c-sharp"},{"name":"mvc-core","slug":"mvc-core"},{"name":"heroku","slug":"heroku"},{"name":"asp-dot-net","slug":"asp-dot-net"}],"slug":"how-to-deploy-asp.net-core-1.0.1-to-heroku-","total":0},{"id":143,"title":"How to Convert given bytes in KB, MB, GB etc?","imageUrl":"2942acea-4a45-42f6-9fa6-fb552e182169_storage.jpg","dateCreated":"2018-10-25T05:32:57.852Z","dateModified":"2018-10-25T05:34:56.322Z","contributedBy":"AskGif","content":"How to calculate total bytes available in particular folder and I want to convert the total bytes available to total bytes available in KB, MB, GB etc?\r\nif you are calculating total bytes then you can use the following function to find out the respective total bytes in KB, MB, GB, TB etc.<","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/2942acea-4a45-42f6-9fa6-fb552e182169_storage.jpg","category":{"name":"coding","slug":"coding"},"tags":[{"name":"c-sharp","slug":"c-sharp"},{"name":"dot-net","slug":"dot-net"},{"name":"questions","slug":"questions"},{"name":"asp-dot-net","slug":"asp-dot-net"}],"slug":"how-to-convert-given-bytes-in-kb-mb-gb-etc","total":0}]}