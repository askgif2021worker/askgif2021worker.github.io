{"id":393,"title":"Running the Microsoft ALM TFS 2013 (Hyper-V) Virtual Machine in VMWare without Persisting Changes","imageUrl":"8164b14e-314b-4ca5-8a41-bf654d541ea9_almwithvs2010.jpg","dateCreated":"2019-06-14T10:47:33.242Z","dateModified":"2019-06-22T08:23:47.968Z","contributedBy":"AskGif","content":"<p>This blog describes how to run the Microsoft TFS/ALM Hyper-V virtual machine in one of the VMWare hypervisors (Player/Workstation/Fusion). You can use the same concepts for any other virtual machine/appliance.</p>\r\n<p>&nbsp;</p>\r\n<p>The 2013 RTM ALM image comes with a set of TFS and Visual studio labs.&nbsp; The virtual machine and the labs&nbsp; have a couple of expectations:</p>\r\n<p>It comes as a Hyper-V VHD running an evaluation copy of Windows Server 2012.</p>\r\n<p>The work items and other information are \"point in time\" information.&nbsp; This means sprint, iteration or other information can only be used in the labs if the VMs time is set to a specific date(s).&nbsp;</p>\r\n<p>The machine resets the time to the same specific date and time on every reboot. This lets you re-run the exercises.&nbsp; Pay attention to the places the way the time is set if you wish to use this process for Virtual Machines anchored at dates and times other than the ones used for the TFS 2013 RTM ALM image used in this post.</p>\r\n<p>The labs work best if the machine is restored back to its initial state after each lab.</p>\r\n<p>We're going to run this virtual disk as a VMWare guest in a machine that automatically sets the Guest RTC to the correct time for the labs.&nbsp; We will also restore the VM to its original state every time VMWare is re-launched.</p>\r\n<p>&nbsp;</p>\r\n<p>VMWare Configuration</p>\r\n<p>You can create a new virtual machine that uses the ALM virtual disk.&nbsp; VMWare can consume the disk directly without conversion.&nbsp; Configure the virtual machine but do not start it until you have manually edited the VMWare vmx file to set up the clock and disks snapshots.</p>\r\n<p>&nbsp;</p>\r\n<p>Create a directory to hold the virtual machine with some reasonable name. We will have VMWare use that directory for all its files later.</p>\r\n<p>Move the vhd virtual disk into the previously created directory.</p>\r\n<p>Run VMWare</p>\r\n<p>Create a new virtual machine</p>\r\n<p>Select Install System Later</p>\r\n<p>Select Microsoft Windows on the Guest operating screen.&nbsp;</p>\r\n<p>Select the Windows version of Hyper-V (unsupported)</p>\r\n<p>Pick a location for the virtual machine.&nbsp; Select the directory we created above</p>\r\n<p>Pick Store virtual disk as a single file.&nbsp; We're not really going to use this disk. We're going to reconfigure the disks later to use the ALM VHD.</p>\r\n<p>Select Finish.&nbsp; This should take you back to the screen that lists all the VMs including the one we just defined.</p>\r\n<p>Select the virtual machine and select Edit virtual machine settings</p>\r\n<p>Add a new IDE disk.&nbsp;&nbsp;</p>\r\n<p>Select Use existing...</p>\r\n<p>Select the VHD</p>\r\n<p>Delete the old virtual disk.&nbsp; We only need one disk and it should be the ALM disk</p>\r\n<p>Do not install VMWare tools</p>\r\n<p>Do not boot the machine</p>\r\n<p>Quit VMWare</p>\r\n<p>Manually edit the VM configuration, vmx, file before booting the machine.</p>\r\n<p>Manual Changes</p>\r\n<p>Disabling Disk Persistence&nbsp;</p>\r\n<p>We want the machine to roll back all session changes so that the VM always starts in exactly the same state.&nbsp; We need to add 3 settings to the VMX file.&nbsp;&nbsp;</p>\r\n<p>ide0:0.mode = \"independent-nonpersistent\"</p>\r\n<p>snapshot.action = \"autoRevert\"</p>\r\n<p>snapshot.disabled = \"TRUE\"</p>\r\n<p>We can remove the settings if we want to do some work that we want to work across restarts. Be careful though. You often can't push the time back if you've already done work on the current time.</p>\r\n<p>&nbsp;</p>\r\n<p>Time at Startup.</p>\r\n<p>The TFS 2013 RTM ALM VM resets its clock to 7/9/2013 1:30 PM ever time it starts via a Task. This puts the machine in a known state and makes time-based labs work.&nbsp; Ex: Think iteration dates here. We want to be inside an iteration when using the sprint planning dashboards.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>You can have a problem with this approach though.&nbsp; A virtual machine's RTC is set to NOW when it boots up. This means the machine boots with the current time before it is reset by the startup tasks.&nbsp; System or SQL changes can occur in the virtual machine before the clock reset occurs creating timestamps later than 7/9/2013 1:30 PM. We need to set the virtual hardware clock before the operating system boots and reads the time.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>The virtual RTC is used by the VM every time it runs. VMWare lets you set the virtual machine RTC at startup with a vmx setting. This web entry describes how we can set the VM time using the VM's virtual bios and RTC.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>VMWare sets the RTC on the Unix Epoch. There are web sites that let you calculate the epoch time from a date and time that you enter. We want to choose an RTC time to just before the time that is set by the ALM vm on startup.&nbsp; This ensures that time moves only forward between bios boot, OS startup, SQL startup, and task execution.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>For this TFS 2013 RTM ALM virtual machine I have chosen 7/9/2013 1:30 AM which is earlier than,7/9/2013 1:30 PM, the ALM machine's OS will be set to after boot. 7/9/2013 1:30 AM maps to 1373334621 in Epoch Time. We add the following vmx entry based on that calculation:</p>\r\n<p>rtc.starttime = \"1373334621\"</p>\r\n<p>The time here is a Unix style epoch time. There are web pages out there that can convert time between human readable and the Unix time format. The TFS 2012&nbsp; and TFS 2013 RC ALM virtual machines used other dates so their rtc.startime should be set accordingly.&nbsp; You can use this same reset process for other lab-oriented virtual machines.&nbsp;</p>\r\n<p>Time Synchronization</p>\r\n<p>VMWare has a set of tools that strive to synchronize time between the guest and the host. The Microsoft ALM Virtual Machine operates as if it is still July 2013 so we need to disable most of the Host/Guest time synchronization&nbsp;</p>\r\n<p>tools.syncTime = \"FALSE\"</p>\r\n<p>time.synchronize.continue = \"FALSE\"</p>\r\n<p>time.synchronize.restore = \"FALSE\"</p>\r\n<p>time.synchronize.resume.disk = \"FALSE\"</p>\r\n<p>time.synchronize.shrink = \"FALSE\"</p>\r\n<p>time.synchronize.tools.startup = \"FALSE\"</p>\r\n<p>time.synchronize.tools.enable = \"FALSE\"</p>\r\n<p>time.synchronize.resume.host = \"FALSE\"</p>\r\n<p>This document describes how VMWare manages time.</p>\r\n<p>&nbsp;</p>\r\n<p>Sample VMX File</p>\r\n<p>Here is my vmx configuration file that works with this service This VM described by this file operates on its own concept of time without syncing to any official time server. It also restores the C: drive disk on every restart.</p>\r\n<p>&nbsp;</p>\r\n<p>You can create a completely new VM based the vmx describe below.</p>\r\n<p>&nbsp;</p>\r\n<p>Create a directory</p>\r\n<p>Put the vhd in the directory.</p>\r\n<p>Create a new vmx file, put it in the created directory and paste the contents from below into the file</p>\r\n<p>You should be able to now just double click on the vmx file to launch the ALM virtual machine.</p>\r\n<p>&nbsp;</p>\r\n<pre class=\"language-csharp\"><code>.encoding = \"windows-1252\"\r\nconfig.version = \"8\"\r\nvirtualHW.version = \"10\"\r\nvcpu.hotadd = \"TRUE\"\r\nscsi0.present = \"TRUE\"\r\nscsi0.virtualDev = \"lsisas1068\"\r\nsata0.present = \"TRUE\"\r\nmemsize = \"4096\"\r\nmem.hotadd = \"TRUE\"\r\nsata0:1.present = \"TRUE\"\r\nsata0:1.autodetect = \"TRUE\"\r\nsata0:1.deviceType = \"cdrom-raw\"\r\nethernet0.present = \"TRUE\"\r\nethernet0.connectionType = \"nat\"\r\nethernet0.virtualDev = \"e1000\"\r\nethernet0.wakeOnPcktRcv = \"FALSE\"\r\nethernet0.addressType = \"generated\"\r\nusb.present = \"TRUE\"\r\nehci.present = \"TRUE\"\r\nehci.pciSlotNumber = \"35\"\r\nusb_xhci.present = \"TRUE\"\r\nsound.present = \"TRUE\"\r\nsound.virtualDev = \"hdaudio\"\r\nsound.fileName = \"-1\"\r\nsound.autodetect = \"TRUE\"\r\nserial0.present = \"TRUE\"\r\nserial0.fileType = \"thinprint\"\r\npciBridge0.present = \"TRUE\"\r\npciBridge4.present = \"TRUE\"\r\npciBridge4.virtualDev = \"pcieRootPort\"\r\npciBridge4.functions = \"8\"\r\npciBridge5.present = \"TRUE\"\r\npciBridge5.virtualDev = \"pcieRootPort\"\r\npciBridge5.functions = \"8\"\r\npciBridge6.present = \"TRUE\"\r\npciBridge6.virtualDev = \"pcieRootPort\"\r\npciBridge6.functions = \"8\"\r\npciBridge7.present = \"TRUE\"\r\npciBridge7.virtualDev = \"pcieRootPort\"\r\npciBridge7.functions = \"8\"\r\nvmci0.present = \"TRUE\"\r\nhpet0.present = \"TRUE\"\r\nusb.vbluetooth.startConnected = \"TRUE\"\r\ndisplayName = \"2013 ALM Hyper-V (unsupported)\"\r\nguestOS = \"winhyperv\"\r\nnvram = \"2013 ALM Hyper-V (unsupported).nvram\"\r\nvirtualHW.productCompatibility = \"hosted\"\r\ngui.exitOnCLIHLT = \"FALSE\"\r\npowerType.powerOff = \"soft\"\r\npowerType.powerOn = \"soft\"\r\npowerType.suspend = \"soft\"\r\npowerType.reset = \"soft\"\r\nextendedConfigFile = \"2013 ALM Hyper-V (unsupported).vmxf\"\r\nide0:0.present = \"TRUE\"\r\nide0:0.fileName = \"TD02WS12SFx64.vhd\"\r\nscsi0:0.present = \"FALSE\"\r\nfloppy0.present = \"FALSE\"\r\nuuid.bios = \"56 4d 6b 23 25 1b 6f 2d-b7 ca e8 22 47 3b ad a3\"\r\nuuid.location = \"56 4d 6b 23 25 1b 6f 2d-b7 ca e8 22 47 3b ad a3\"\r\nreplay.supported = \"FALSE\"\r\nreplay.filename = \"\"\r\nide0:0.redo = \"\"\r\npciBridge0.pciSlotNumber = \"17\"\r\npciBridge4.pciSlotNumber = \"21\"\r\npciBridge5.pciSlotNumber = \"22\"\r\npciBridge6.pciSlotNumber = \"23\"\r\npciBridge7.pciSlotNumber = \"24\"\r\nscsi0.pciSlotNumber = \"160\"\r\nusb.pciSlotNumber = \"32\"\r\nethernet0.pciSlotNumber = \"33\"\r\nsound.pciSlotNumber = \"34\"\r\nusb_xhci.pciSlotNumber = \"192\"\r\nvmci0.pciSlotNumber = \"36\"\r\nsata0.pciSlotNumber = \"37\"\r\nscsi0.sasWWID = \"50 05 05 63 25 1b 6f 20\"\r\nethernet0.generatedAddress = \"00:0c:29:3b:ad:a3\"\r\nethernet0.generatedAddressOffset = \"0\"\r\nvmci0.id = \"1195093411\"\r\nvmotion.checkpointFBSize = \"33554432\"\r\ncleanShutdown = \"TRUE\"\r\nsoftPowerOff = \"TRUE\"\r\nusb_xhci:1.speed = \"2\"\r\nusb_xhci:1.present = \"TRUE\"\r\nusb_xhci:1.deviceType = \"hub\"\r\nusb_xhci:1.port = \"1\"\r\nusb_xhci:1.parent = \"-1\"\r\nusb_xhci:3.speed = \"4\"\r\nusb_xhci:3.present = \"TRUE\"\r\nusb_xhci:3.deviceType = \"hub\"\r\nusb_xhci:3.port = \"3\"\r\nusb_xhci:3.parent = \"-1\"\r\ntoolsInstallManager.updateCounter = \"8\"\r\nsata0:1.startConnected = \"FALSE\"\r\nunity.wasCapable = \"FALSE\"\r\ntools.remindInstall = \"TRUE\"\r\n \r\nide0:0.mode = \"independent-nonpersistent\"\r\nsnapshot.action = \"autoRevert\"\r\nsnapshot.disabled = \"TRUE\"\r\n \r\nrtc.starttime = \"1373362200\"\r\ntools.syncTime = \"FALSE\"\r\ntime.synchronize.continue = \"FALSE\"\r\ntime.synchronize.restore = \"FALSE\"\r\ntime.synchronize.resume.disk = \"FALSE\"\r\ntime.synchronize.shrink = \"FALSE\"\r\ntime.synchronize.tools.startup = \"FALSE\"\r\ntime.synchronize.tools.enable = \"FALSE\"\r\ntime.synchronize.resume.host = \"FALSE\"\r\n \r\nusb_xhci:4.present = \"TRUE\"\r\nusb_xhci:4.deviceType = \"hid\"\r\nusb_xhci:4.port = \"0\"\r\nusb_xhci:4.parent = \"1\"\r\n</code></pre>\r\n<p>&nbsp;</p>\r\n<p>Conclusion</p>\r\n<p>You can use these techniques to create/manage Virtual Machines that need to restore back to the previous state on every restart.&nbsp; You can configure these same machines to put the hardware back at that same or other times.</p>","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/8164b14e-314b-4ca5-8a41-bf654d541ea9_almwithvs2010.jpg","subContents":[],"category":{"name":"coding","slug":"coding"},"slug":"running-the-microsoft-alm-tfs-2013-hyper-v-virtual-machine-in-vmware-without-persisting-changes","tags":[{"name":"hyper-v","slug":"hyper-v"},{"name":"vmware","slug":"vmware"},{"name":"microsoft","slug":"microsoft"},{"name":"virtualbox","slug":"virtualbox"}],"recommendations":[{"id":958,"title":"Think in crore and lakhs, here is how much employees earn in companies like Google and Facebook","imageUrl":"d51fb183-cbe7-4b32-a8f4-5df672ebcb90_tech-giant.jpg","dateCreated":"2019-11-07T02:16:27.587Z","dateModified":"2020-04-05T07:12:25.767Z","contributedBy":"AskGif","content":"Google is the top company to work with followed by Facebook and Microsoft at second and third spots respectively. We are not saying this. A recent survey done by Comparably, a career site analyzer, across 50,000 employees has revealed that these are top tech companies to work with based on factor","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/d51fb183-cbe7-4b32-a8f4-5df672ebcb90_tech-giant.jpg","category":{"name":"news","slug":"news"},"tags":[{"name":"microsoft","slug":"microsoft"},{"name":"google","slug":"google"},{"name":"facebook","slug":"facebook"}],"slug":"think-in-crore-and-lakhs-here-is-how-much-employees-earn-in-companies-like-google-and-facebook","total":0},{"id":507,"title":"Implementing Oauth Login for Linkedin, Facebook, Google and Microsoft","imageUrl":"3777aeef-ad18-459b-8370-2306287f22e6_OauthBanner.jpg","dateCreated":"2019-08-29T11:58:16.72Z","dateModified":"2019-08-29T11:58:30.055Z","contributedBy":"AskGif","content":"Introducing the new lightweight OAuth Login commercial edition, an OAuth login system for your website with Facebook, Google, Microsoft and Linkedin. OAuth Login is very quick and powerful, sure this helps you to increase your web project registrations. It's definitely a must-have login system fo","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/3777aeef-ad18-459b-8370-2306287f22e6_OauthBanner.jpg","category":{"name":"coding","slug":"coding"},"tags":[{"name":"microsoft","slug":"microsoft"},{"name":"facebook","slug":"facebook"},{"name":"google-plus","slug":"google-plus"},{"name":"linkedin","slug":"linkedin"},{"name":"php","slug":"php"}],"slug":"implementing-oauth-login-for-linkedin-facebook-google-and-microsoft","total":0},{"id":393,"title":"Running the Microsoft ALM TFS 2013 (Hyper-V) Virtual Machine in VMWare without Persisting Changes","imageUrl":"8164b14e-314b-4ca5-8a41-bf654d541ea9_almwithvs2010.jpg","dateCreated":"2019-06-14T10:47:33.242Z","dateModified":"2019-06-22T08:23:47.968Z","contributedBy":"AskGif","content":"This blog describes how to run the Microsoft TFS/ALM Hyper-V virtual machine in one of the VMWare hypervisors (Player/Workstation/Fusion). You can use the same concepts for any other virtual machine/appliance.\r\n&nbsp;\r\nThe 2013 RTM ALM image comes with a set of TFS and Visual studio","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/8164b14e-314b-4ca5-8a41-bf654d541ea9_almwithvs2010.jpg","category":{"name":"coding","slug":"coding"},"tags":[{"name":"hyper-v","slug":"hyper-v"},{"name":"vmware","slug":"vmware"},{"name":"microsoft","slug":"microsoft"},{"name":"virtualbox","slug":"virtualbox"}],"slug":"running-the-microsoft-alm-tfs-2013-hyper-v-virtual-machine-in-vmware-without-persisting-changes","total":0},{"id":153,"title":"How to mount a VirtualBox shared folder?","imageUrl":"02aa9115-563d-4a68-b4ef-92c28e8b53ae_ubuntu-shared-folder.png","dateCreated":"2018-11-22T11:47:39.038Z","dateModified":"2018-11-22T11:47:47.217Z","contributedBy":"AskGif","content":"To be able to mount a VirtualBox shared folder between your windows and Linux machine you need to do the following steps.\r\nFirst add your share directory in the VM Box:\r\nWhatever you name your share here will be the name you will need to use when mounting in the vm guest OS. i.e. I ","ampImage":"https://raw.githubusercontent.com/sumitc91/AmpImage/main/Blogs/02aa9115-563d-4a68-b4ef-92c28e8b53ae_ubuntu-shared-folder.png","category":{"name":"coding","slug":"coding"},"tags":[{"name":"ubuntu","slug":"ubuntu"},{"name":"virtualbox","slug":"virtualbox"}],"slug":"how-to-mount-a-virtualbox-shared-folder","total":0}]}